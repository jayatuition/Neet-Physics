// 1. Topic Mapping: Add your Topic IDs and Names here
const topicNames = {
  "T01": "Kinematics - Motion in a Straight Line",
  "T02": "Laws of Motion",
  "T03": "Work, Energy, and Power"
  // Add more as you create them in your Sheet
};

async function fetchQuestions() {
  const querySnapshot = await getDocs(collection(db, "questions"));
  querySnapshot.forEach((doc) => questions.push(doc.data()));
  questions.sort(() => Math.random() - 0.5);
  displayQuestion();
}

window.displayQuestion = function() {
  const q = questions[currentIndex];
  
  // Convert T01 to Actual Topic Name
  const friendlyTopic = topicNames[q.topic_id] || q.topic_id;
  document.getElementById('topic-tag').innerText = friendlyTopic;

  document.getElementById('question-text').innerHTML = q.question;
  document.getElementById('explanation-box').style.display = 'none';
  document.getElementById('next-btn').style.display = 'none';

  // Handle images from Column I
  const imgElement = document.getElementById('question-image');
  if (q.image_url && q.image_url.trim() !== "") {
      imgElement.src = q.image_url;
      imgElement.style.display = 'block';
  } else {
      imgElement.style.display = 'none';
  }

  const options = [q.optionA, q.optionB, q.optionC, q.optionD];
  const container = document.getElementById('options-container');
  container.innerHTML = '';

  options.forEach((opt, index) => {
      const btn = document.createElement('button');
      btn.className = 'option';
      btn.innerHTML = opt;
      // Answer Index is 1-based (1=A, 2=B, etc.)
      btn.onclick = (e) => checkAnswer(e.target, index + 1, q.correct_code, q.explanation);
      container.appendChild(btn);
  });

  MathJax.typeset();
}

function checkAnswer(selectedElement, selectedIndex, correctIndex, explanation) {
  const allOptions = document.querySelectorAll('.option');
  
  // Disable all buttons after one click
  allOptions.forEach(btn => btn.style.pointerEvents = 'none');

  // Logic to show Correct/Wrong
  if (selectedIndex === correctIndex) {
      selectedElement.style.background = "#d1fae5"; // Green for Correct
      selectedElement.style.borderColor = "#059669";
      selectedElement.innerHTML += " ✅ <b>Correct!</b>";
  } else {
      selectedElement.style.background = "#fee2e2"; // Red for Wrong
      selectedElement.style.borderColor = "#dc2626";
      selectedElement.innerHTML += " ❌ <b>Wrong Answer</b>";
      
      // Highlight the right answer in green
      allOptions[correctIndex - 1].style.background = "#d1fae5";
      allOptions[correctIndex - 1].style.borderColor = "#059669";
  }

  // Show Explanation from Column H
  const box = document.getElementById('explanation-box');
  document.getElementById('explanation-text').innerHTML = explanation;
  box.style.display = 'block';
  document.getElementById('next-btn').style.display = 'inline-block';
  
  MathJax.typeset();
}
