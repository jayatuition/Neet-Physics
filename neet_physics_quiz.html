<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEET Physics Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .logo {
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            display: none; /* Will show when logo is added */
        }

        .controls {
            display: flex;
            justify-content: space-around;
            padding: 20px;
            background: #f8f9fa;
            flex-wrap: wrap;
            gap: 15px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .control-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        select, .timer, .question-counter {
            padding: 10px 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            background: white;
        }

        select {
            cursor: pointer;
            min-width: 200px;
        }

        .timer {
            font-weight: bold;
            color: #667eea;
            min-width: 100px;
            text-align: center;
        }

        .question-counter {
            font-weight: bold;
            color: #764ba2;
            min-width: 100px;
            text-align: center;
        }

        .content {
            padding: 30px;
        }

        .start-screen {
            text-align: center;
            padding: 40px;
        }

        .start-screen h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .start-screen p {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            margin-left: 10px;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .question-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .question-text {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            padding: 15px 20px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            font-size: 1.1em;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .option.selected {
            border-color: #667eea;
            background: #e7eaff;
        }

        .option.correct {
            border-color: #28a745;
            background: #d4edda;
        }

        .option.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .explanation {
            margin-top: 20px;
            padding: 20px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 5px;
            display: none;
        }

        .explanation.show {
            display: block;
        }

        .explanation h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .explanation p {
            color: #856404;
            line-height: 1.6;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .score-screen {
            text-align: center;
            padding: 40px;
        }

        .score-screen h2 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .score-display {
            font-size: 4em;
            color: #667eea;
            font-weight: bold;
            margin: 30px 0;
        }

        .score-details {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            flex-wrap: wrap;
            gap: 20px;
        }

        .score-item {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            min-width: 150px;
        }

        .score-item h3 {
            color: #666;
            font-size: 1em;
            margin-bottom: 10px;
        }

        .score-item p {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.5em;
            color: #667eea;
        }

        .error {
            text-align: center;
            padding: 50px;
            color: #dc3545;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .controls {
                flex-direction: column;
            }

            .question-text {
                font-size: 1.1em;
            }

            .option {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>NEET PHYSICS PRACTICE</h1>
            <div class="logo" id="logo"></div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="topicSelect">Select Topic:</label>
                <select id="topicSelect">
                    <option value="">Loading topics...</option>
                </select>
            </div>
            <div class="control-group">
                <label>Timer:</label>
                <div class="timer" id="timer">00:00</div>
            </div>
            <div class="control-group">
                <label>Progress:</label>
                <div class="question-counter" id="questionCounter">0/0</div>
            </div>
        </div>

        <div class="content" id="content">
            <div class="start-screen">
                <h2>Welcome to NEET Physics Practice!</h2>
                <p>Select a topic from the dropdown above and click Start to begin your practice session.</p>
                <p id="connectionStatus" style="color: #667eea; font-size: 0.9em; margin-top: 10px;">
                    ðŸ”„ Connecting to Firebase...
                </p>
                <button class="btn btn-primary" id="startBtn" disabled>Start Quiz</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Firebase Configuration
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // TODO: Replace with your Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        console.log('Firebase initialized successfully');
        console.log('Database URL:', firebaseConfig.databaseURL);

        // Topic ID to Name mapping
        const topicMap = {
            'T01': 'Mechanics',
            'T02': 'Thermodynamics',
            'T03': 'Waves and Optics',
            'T04': 'Electricity and Magnetism',
            'T05': 'Modern Physics',
            'T06': 'Kinematics',
            'T07': 'Laws of Motion',
            'T08': 'Work, Energy and Power',
            'T09': 'Rotational Motion',
            'T10': 'Gravitation'
        };

        // Global variables
        let allQuestions = [];
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let correctAnswers = 0;
        let incorrectAnswers = 0;
        let timerInterval = null;
        let startTime = null;
        let selectedTopic = '';

        // DOM elements
        const topicSelect = document.getElementById('topicSelect');
        const startBtn = document.getElementById('startBtn');
        const content = document.getElementById('content');
        const timer = document.getElementById('timer');
        const questionCounter = document.getElementById('questionCounter');

        // Fetch questions from Firebase
        function loadQuestions() {
            console.log('Attempting to load questions from Firebase...');
            const questionsRef = ref(db, 'questions'); // Adjust path as needed
            
            onValue(questionsRef, (snapshot) => {
                const data = snapshot.val();
                console.log('Firebase data received:', data);
                
                if (data) {
                    // Handle both array and object formats
                    allQuestions = Array.isArray(data) ? data : Object.values(data);
                    console.log('Total questions loaded:', allQuestions.length);
                    
                    if (allQuestions.length > 0) {
                        populateTopics();
                    } else {
                        showError('No questions found in database. Please check your Firebase data structure.');
                    }
                } else {
                    showError('No data found at path "questions". Please verify:<br>1. Firebase configuration is correct<br>2. Data exists in Firebase<br>3. Database path is "questions"<br>4. Security rules allow read access');
                }
            }, (error) => {
                console.error('Firebase error:', error);
                showError('Error loading questions: ' + error.message + '<br><br>Please check:<br>1. Firebase configuration<br>2. Internet connection<br>3. Database URL is correct<br>4. Security rules allow read access');
            });
        }

        // Populate topic dropdown
        function populateTopics() {
            const topics = [...new Set(allQuestions.map(q => q.topic_id))].sort();
            console.log('Topics found:', topics);
            
            topicSelect.innerHTML = '<option value="">-- Select a Topic --</option>';
            
            topics.forEach(topicId => {
                const option = document.createElement('option');
                option.value = topicId;
                option.textContent = topicMap[topicId] || `Topic ${topicId}`;
                topicSelect.appendChild(option);
            });

            startBtn.disabled = false;
            
            // Update connection status
            const statusEl = document.getElementById('connectionStatus');
            if (statusEl) {
                statusEl.innerHTML = 'âœ… Connected! ' + allQuestions.length + ' questions loaded';
                statusEl.style.color = '#28a745';
            }
            
            console.log('Topics populated successfully');
        }

        // Start quiz
        function startQuiz() {
            selectedTopic = topicSelect.value;
            if (!selectedTopic) {
                alert('Please select a topic first!');
                return;
            }

            currentQuestions = allQuestions.filter(q => q.topic_id === selectedTopic);
            if (currentQuestions.length === 0) {
                alert('No questions available for this topic!');
                return;
            }

            currentQuestionIndex = 0;
            score = 0;
            correctAnswers = 0;
            incorrectAnswers = 0;
            startTimer();
            showQuestion();
        }

        // Start timer
        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                timer.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }, 1000);
        }

        // Show question
        function showQuestion() {
            if (currentQuestionIndex >= currentQuestions.length) {
                showScore();
                return;
            }

            const question = currentQuestions[currentQuestionIndex];
            questionCounter.textContent = `${currentQuestionIndex + 1}/${currentQuestions.length}`;

            content.innerHTML = `
                <div class="question-card">
                    <div class="question-text">
                        <strong>Q${currentQuestionIndex + 1}:</strong> ${question.Question}
                    </div>
                    <div class="options">
                        <div class="option" data-option="A">
                            <strong>A.</strong> ${question['Option A']}
                        </div>
                        <div class="option" data-option="B">
                            <strong>B.</strong> ${question['Option B']}
                        </div>
                        <div class="option" data-option="C">
                            <strong>C.</strong> ${question['Option C']}
                        </div>
                        <div class="option" data-option="D">
                            <strong>D.</strong> ${question['Option D']}
                        </div>
                    </div>
                    <div class="explanation" id="explanation">
                        <h4>Explanation:</h4>
                        <p>${question.Explanation || 'No explanation available.'}</p>
                    </div>
                </div>
                <div class="navigation">
                    <button class="btn btn-secondary" id="exitBtn">Exit Quiz</button>
                    <button class="btn btn-primary" id="nextBtn" style="display:none;">Next Question</button>
                </div>
            `;

            // Add event listeners
            document.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', () => selectOption(option));
            });

            document.getElementById('exitBtn').addEventListener('click', exitQuiz);
            const nextBtn = document.getElementById('nextBtn');
            if (nextBtn) {
                nextBtn.addEventListener('click', nextQuestion);
            }
        }

        // Select option
        function selectOption(optionElement) {
            const options = document.querySelectorAll('.option');
            if (options[0].classList.contains('disabled')) return;

            const selectedOption = optionElement.dataset.option;
            const question = currentQuestions[currentQuestionIndex];
            const correctOption = question['Correct Option'];

            // Disable all options
            options.forEach(opt => {
                opt.classList.add('disabled');
                if (opt.dataset.option === correctOption) {
                    opt.classList.add('correct');
                }
            });

            // Mark selected option
            optionElement.classList.add('selected');
            if (selectedOption !== correctOption) {
                optionElement.classList.add('incorrect');
                incorrectAnswers++;
            } else {
                correctAnswers++;
                score++;
            }

            // Show explanation and next button
            document.getElementById('explanation').classList.add('show');
            document.getElementById('nextBtn').style.display = 'block';
        }

        // Next question
        function nextQuestion() {
            currentQuestionIndex++;
            showQuestion();
        }

        // Show score
        function showScore() {
            clearInterval(timerInterval);
            const totalTime = timer.textContent;
            const percentage = Math.round((score / currentQuestions.length) * 100);

            content.innerHTML = `
                <div class="score-screen">
                    <h2>Quiz Complete! ðŸŽ‰</h2>
                    <div class="score-display">${percentage}%</div>
                    <div class="score-details">
                        <div class="score-item">
                            <h3>Correct</h3>
                            <p style="color: #28a745;">${correctAnswers}</p>
                        </div>
                        <div class="score-item">
                            <h3>Incorrect</h3>
                            <p style="color: #dc3545;">${incorrectAnswers}</p>
                        </div>
                        <div class="score-item">
                            <h3>Total Time</h3>
                            <p>${totalTime}</p>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="restartBtn">Try Another Topic</button>
                    <button class="btn btn-secondary" id="retryBtn">Retry Same Topic</button>
                </div>
            `;

            document.getElementById('restartBtn').addEventListener('click', () => {
                location.reload();
            });

            document.getElementById('retryBtn').addEventListener('click', () => {
                startQuiz();
            });
        }

        // Exit quiz
        function exitQuiz() {
            if (confirm('Are you sure you want to exit? Your progress will be lost.')) {
                clearInterval(timerInterval);
                location.reload();
            }
        }

        // Show error
        function showError(message) {
            content.innerHTML = `
                <div class="error">
                    <h2>Error</h2>
                    <p>${message}</p>
                </div>
            `;
        }

        // Event listeners
        topicSelect.addEventListener('change', () => {
            startBtn.disabled = !topicSelect.value;
        });

        startBtn.addEventListener('click', startQuiz);

        // Initialize
        loadQuestions();
    </script>
</body>
</html>